<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Keranjang Belanja</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="apalah.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <div id="notif" class="notif"></div>
    <div class="container">
        <div class="cart-title">
            <i class="fas fa-shopping-cart"></i>
            <h1>Keranjang Belanja</h1>
        </div>
        <div style="display:flex; gap:12px; margin-bottom:18px; z-index:2; position:relative;">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i> Beranda
            </a>
            <a href="produk.html" class="nav-btn">
                <i class="fas fa-box"></i> Lihat Produk Lainnya
            </a>
        </div>
        <div class="highlight-info">
            <i class="fas fa-info-circle"></i>
            Pastikan data pengiriman dan email kamu benar agar pesanan cepat diproses. Semua produk Arduino original & bergaransi!
        </div>
        <form id="checkout-form" autocomplete="off">
            <div class="form-section">
                <h2><i class="fas fa-user"></i> Data Pemesan</h2>
                <div class="form-group">
                    <label for="nama"><i class="fas fa-user"></i> Nama Lengkap</label>
                    <input type="text" id="nama" name="nama" required placeholder="Nama lengkap">
                </div>
                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="email" name="email" required placeholder="email@domain.com">
                </div>
                <div class="form-hint">Email digunakan untuk mengirimkan invoice & status pesanan.</div>
                <div class="form-group">
                    <label for="alamat"><i class="fas fa-map-marker-alt"></i> Alamat Pengiriman</label>
                    <textarea id="alamat" name="alamat" required placeholder="Alamat lengkap"></textarea>
                </div>
                <div class="form-group">
                    <label for="telp"><i class="fas fa-phone"></i> No. HP/WA</label>
                    <input type="tel" id="telp" name="telp" required placeholder="08xxxxxxxxxx">
                </div>
                <div class="form-group">
                    <label for="catatan"><i class="fas fa-sticky-note"></i> Catatan</label>
                    <textarea id="catatan" name="catatan" placeholder="(Opsional)"></textarea>
                </div>
            </div>
            <hr class="divider">
            <table>
                <thead>
                    <tr>
                        <th>Produk</th>
                        <th>Harga</th>
                        <th>Jumlah</th>
                        <th>Subtotal</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="cart-body">
                    <tr>
                        <td>Arduino Uno R3</td>
                        <td class="price" data-value="250000">Rp250.000</td>
                        <td>
                            <input type="number" class="qty" value="1" min="1">
                        </td>
                        <td class="subtotal">Rp250.000</td>
                        <td>
                            <button type="button" class="remove-btn">Hapus</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Arduino Nano Every</td>
                        <td class="price" data-value="180000">Rp180.000</td>
                        <td>
                            <input type="number" class="qty" value="2" min="1">
                        </td>
                        <td class="subtotal">Rp360.000</td>
                        <td>
                            <button type="button" class="remove-btn">Hapus</button>
                        </td>
                    </tr>
                    <tr>
                        <td>ESP8266 WiFi Module</td>
                        <td class="price" data-value="45000">Rp45.000</td>
                        <td>
                            <input type="number" class="qty" value="3" min="1">
                        </td>
                        <td class="subtotal">Rp135.000</td>
                        <td>
                            <button type="button" class="remove-btn">Hapus</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div id="empty-placeholder" class="empty" style="display:none;">Keranjang kosong â€” tambahkan produk di halaman produk.</div>
            <div class="total" id="cart-total">Total: Rp0</div>
            <button class="checkout-btn" id="checkout-btn" type="submit">
                <i class="fas fa-credit-card"></i> Checkout
            </button>
        </form>
    </div>

    <script>
        (function () {
            const formatRupiah = num => 'Rp' + String(num).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            const tbody = document.getElementById('cart-body');
            const totalEl = document.getElementById('cart-total');
            const notif = document.getElementById('notif');
            const checkoutBtn = document.getElementById('checkout-btn');
            const emptyPlaceholder = document.getElementById('empty-placeholder');

            function showNotif(message, type) {
                notif.textContent = message;
                notif.className = 'notif show ' + (type || 'info');
                setTimeout(() => notif.className = 'notif ' + (type || 'info'), 3000);
            }

            function updateRowSubtotal(row) {
                const priceEl = row.querySelector('.price');
                const qtyEl = row.querySelector('.qty');
                const subtotalEl = row.querySelector('.subtotal');
                const price = parseInt(priceEl.getAttribute('data-value'), 10) || 0;
                const qty = Math.max(1, parseInt(qtyEl.value, 10) || 1);
                const subtotal = price * qty;
                subtotalEl.textContent = formatRupiah(subtotal);
                return subtotal;
            }

            function updateTotal() {
                const rows = Array.from(tbody.querySelectorAll('tr'));
                let total = 0;
                rows.forEach(r => total += updateRowSubtotal(r));
                totalEl.textContent = 'Total: ' + formatRupiah(total);
                if (rows.length === 0) {
                    emptyPlaceholder.style.display = 'block';
                    checkoutBtn.disabled = true;
                } else {
                    emptyPlaceholder.style.display = 'none';
                    checkoutBtn.disabled = false;
                }
            }

            updateTotal();

            tbody.addEventListener('input', e => {
                if (e.target.matches('.qty')) {
                    if (parseInt(e.target.value, 10) <= 0) e.target.value = 1;
                    updateTotal();
                }
            });

            tbody.addEventListener('click', e => {
                if (e.target.matches('.remove-btn')) {
                    const row = e.target.closest('tr');
                    const name = row.cells[0].textContent.trim();
                    row.remove();
                    updateTotal();
                    showNotif(name + ' dihapus dari keranjang', 'success');
                }
            });

            document.getElementById('checkout-form').addEventListener('submit', function (e) {
                e.preventDefault();
                const name = this.querySelector('#nama').value.trim();
                const email = this.querySelector('#email').value.trim();
                const alamat = this.querySelector('#alamat').value.trim();
                const telp = this.querySelector('#telp').value.trim();
                const rows = tbody.querySelectorAll('tr');

                if (!name || !email || !alamat || !telp) {
                    showNotif('Lengkapi semua data pemesan.', 'error');
                    return;
                }
                if (rows.length === 0) {
                    showNotif('Keranjang kosong.', 'error');
                    return;
                }

                let order = [];
                let total = 0;
                rows.forEach(r => {
                    const title = r.cells[0].textContent.trim();
                    const price = parseInt(r.querySelector('.price').getAttribute('data-value'), 10);
                    const qty = parseInt(r.querySelector('.qty').value, 10);
                    const subtotal = price * qty;
                    total += subtotal;
                    order.push({ title, price, qty, subtotal });
                });

                showNotif('Pesanan berhasil diproses! Invoice dikirim ke ' + email, 'success');

                tbody.innerHTML = '';
                updateTotal();
                this.reset();
            });
        })();
    </script>
</body>
</html>
